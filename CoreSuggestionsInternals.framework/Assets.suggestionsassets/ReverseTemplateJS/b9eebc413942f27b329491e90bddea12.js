// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline-car-confirmation-en",function(e){return/^Your priceline itinerary/.test(e.subject)},function(e){if(/Vacation Package Confirmation/.test(e.plain))return CONTINUE;if(/^Your priceline itinerary/.test(e.subject)&&(/Thanks for booking your rental car/.test(e.plain)||/Rental Car Confirmation/.test(e.plain))){var t=loadHelper("priceline-schemaorg-parser.js"),n=t(e);if(n)return n;var r="en_US",a={};a.pickUpDateTime_prefix=/Pick-up/,a.dropOffDateTime_prefix=/Drop-off/,a.address_prefix=/Rental Location/,a.reservationId_prefix=/Confirmation Number:/,a.providerName_prefix=/Rental Partner:/,a.underPersonName_prefix=/Driver Name:/;var i=loadHelper("priceline-car-confirmation-skeleton.js");return i(e,r,a)}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1010/1168/1169","SG5ccaa7b0"),new ReverseTemplate("priceline-flight-confirmation-en",function(e){return/^Your priceline itinerary/.test(e.subject)},function(e){if(/Vacation Package Confirmation/.test(e.plain))return CONTINUE;if(/^Your priceline itinerary/.test(e.subject)&&/Your Flight Confirmation/.test(e.plain)){var t=loadHelper("priceline-schemaorg-parser.js"),n=t(e);if(n)return n}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1010/1168/1170","SGa8c88812"),new ReverseTemplate("priceline-package-confirmation-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){function t(e,t){var n=e.innerAddress();if(n.getLength()>0)for(var r=n.split(" ")[0],a=1;t.length>a;a++)if((""+t[a]).split(" ")[0]===""+r){e=n;break}return""+e}var n=Scanner.fromMessage(e);if(n.setLocale("en_US"),/^Your priceline itinerary for/.test(e.subject)||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()){var r,a,i,o,s,p,l,g,m,c,u,d,x,f,h,T,C,v,S,b,y,N,k,R,A,P,I,D,U,$,F,E,O,j,L,w,Z,z,Y,_,H,G,M,V=[],B=[],q=[],J={},K=[],Q=[];if(n.getSpan().nextText("time to pack your bags").exists())N=!0,a=n.getSpan().nextText("time to pack your bags!").parentAnyTag("td").tagContents().innerCapture(/(.*), it's time to pack your bags!/,1),J[""+a]={name:""+a,totalPrice:null,currency:null,seats:{},seatingType:{}},d=n.getSpan().nextText("Departing").parentTag("table5").allInnerTags("table8").map(function(e){return e.allInnerTagsFiltered("td8")}).filter(function(e){return e.length>=3});else{if(o=n.getSpan().nextText("Amount Charged to Card").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1),c=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1),B=n.getSpan().nextText("Passenger and Ticket Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),B.length)for(var W=0,X=B.length;X>W;W+=4)a=B[W][1],not(a)||(J[""+a]={name:""+a,totalPrice:s,currency:c,seats:{},seatingType:{}});d=n.getSpan().nextText("Flight Details").nextTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3})}if(d.length)for(var ee,W=0;ee=d[W];W++)if(""+ee[0]=="Departing")i=ee[0].withStart(ee[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),v=i?i.$departureCode:null,y=i?i.$arrivalCode:null,C=ee[1],T=ee[2].innerDate();else if(""+ee[0]=="Arriving")b=ee[1],S=ee[2].innerDate();else if(""+ee[0]=="Flight / Class"||""+ee[0]=="Airline / Flight"){if(f=ee[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),h=f?f.$name:null,x=f?f.$flightNumber:null,N?(u=null,l=ee[2]&&ee[2].innerCapture(/Conf Number: (.*)/,1)):(u=ee[2],l=ee[3]&&ee[3].innerCapture(/Conf Number: (.*)/,1)),valid(x)){B=Object.keys(J);for(var a,te=0;a=B[te];te++)J[a].seatingType[""+x]=u}ASSERT(h,x,C,T,v,b,S,y)&&(q.push({airlineName:h,flightNumber:x,departureAirport:C,departureCode:v,departureTime:T,arrivalAirport:b,arrivalTime:S,arrivalCode:y,reservationId:l,passengers:J}),f=h=x=C=T=v=b=S=y=l=null)}if(!n.getSpan().nextText("Hotel Reservation").exists()&&!n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()||(n.getSpan().nextText("Hotel Reservation").exists()?(a=n.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),l=n.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=n.getSpan().nextText("Hotel Reservation"),I=i.nextTag("td9").tagContents(),A=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),D=A.innerPhoneNumber(),U=A.tagContents(),D.exists()&&(U=U.withEnd(D.getStart()).trim()),A.innerAddress().getLength()>=U.getLength()&&(U=A.innerAddress()),k=i.nextText("Check-In").nextTag("td11").innerDate(),R=i.nextText("Check-Out").nextTag("td11").innerDate(),s=n.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&!n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()&&(a=n.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),l=n.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),I=n.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),A=I.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),U=A?A.$address:null,D=A?A.$phone:null,k=n.getSpan().nextText("Check-In").nextDate(),R=n.getSpan().nextText("Check-Out").nextDate()),ASSERT(k,R,U)&&K.push({name:a,reservationId:l,totalPrice:s,priceCurrency:p,checkInDateTime:k,checkOutDateTime:R,hotelName:I,hotelUrl:P,hotelPhone:D,hotelAddress:U})),n.getSpan().nextText("Your Rental Car Confirmation").exists()){M=n.getSpan().next(/Pick-up: \n/).nextDate(),H=n.getSpan().nextText("Rental Location").nextAddress(),z=n.getSpan().next(/Drop-off: \n/).nextDate(),w=H,a=n.getSpan().next(/Driver Name: \n+(.*?)\s\s/).innerCapture(/Driver Name: \n+(.*?)\s\s/,1).trim(),l=n.getSpan().next(/Confirmation Number: \n+(.*?)\s/).innerCapture(/Confirmation Number: \n+(.*?)\s/,1),$=n.getSpan().next(/Modify Reservation/).nextLink(),F=n.getSpan().next(/Cancel Reservation/).nextLink(),O=n.getSpan().next(/Rental Car Contact Information/).nextTag("td6").tagContents().trim(),l.exists()&&(E=n.getSpan().next(/Car Type: \n+(.*)\n/).innerCapture(/Car Type: \n+(.*)\n/,1).trim()),Z=n.getSpan().next(/Phone Number \n+(.*?)\s\s/).innerCapture(/Phone Number \n+(.*?)\s\s/,1).trim(),G=Z;var ne=n.getSpan().next("Estimated Total").nextAnyTag("td");s=ne.tagContents().innerCapture(/.*?([\d,.]+)/,1).trim(),p=ne.tagContents().innerCapture(/(\w+)\s.*?[\d,.]+/,1).trim(),ASSERT(M,O,l,OR(H,_))&&Q.push({name:a,brand:E,pickupTime:M,pickupName:_,pickupAddress:H,pickupTelephone:G,dropoffTime:z,dropoffName:L,dropoffAddress:w,dropoffTelephone:Z,provider:O,reservationId:l,reservationStatus:g,totalPrice:s,priceCurrency:p,modifyReservationUrl:$,cancelReservationUrl:F})}else if(n.getSpan().nextText("Rental Car Confirmation").exists()){if(Y=n.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),Y.length>=3&&(M=Y[0].innerDate(),_=Y[1].tagContents(),H=n.getDetachedSpan(Y.slice(2).join(" ")),H=t(H,Y)),j=n.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),j.length>=3&&(z=j[0].innerDate(),L=j[1].tagContents(),w=n.getDetachedSpan(j.slice(2).join(" ")),w=t(w,j)),a=n.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),l=n.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),!l.exists()){var re=n.getSpan().next(/Rental Car Confirmation Number.*\n(.*?)\:\s+(\w+)/).innerCapture(/Rental Car Confirmation Number.*\n($<provider>.*?)\:\s+($<reservationId>\w+)/);O=re.$provider,l=re.$reservationId}if($=n.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),F=n.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),l.exists()&&(O&&O.exists()||(O=n.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+l),1)),O.exists())){var ae=n.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();E=ae.innerCapture(regExpFormatted(/\1 (.*)$/,""+O),1),E.exists()||(""+ae).match(/\n/)&&(E=ae.withStart(ae.next("\n").getEnd()))}Z=(""+n.getSpan().nextText("Phone Number").nextTag("td10").tagContents()).trim(),G=Z,s=n.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)\(?/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(M,O,l,OR(H,_))&&Q.push({name:a,brand:E,pickupTime:M,pickupName:_,pickupAddress:H,pickupTelephone:G,dropoffTime:z,dropoffName:L,dropoffAddress:w,dropoffTelephone:Z,provider:O,reservationId:l,reservationStatus:g,totalPrice:s,priceCurrency:p,modifyReservationUrl:$,cancelReservationUrl:F})}for(var W=0;q.length>W;W++)for(var ie=q[W],oe=Object.keys(ie.passengers),se=0;oe.length>se;se++){var pe=ie.passengers[oe[se]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:ie.airlineName,flightNumber:ie.flightNumber,departureAirportFuzzy:ie.departureAirport,departureAirportCode:ie.departureCode,departureTime:ie.departureTime,arrivalAirportFuzzy:ie.arrivalAirport,arrivalAirportCode:ie.arrivalCode,arrivalTime:ie.arrivalTime},underName:{"@type":"http://schema.org/Person",name:pe.name},checkinUrl:m,reservationId:ie.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:pe.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:pe.seats[ie.flightNumber],seatingType:pe.seatingType[ie.flightNumber]}},totalPrice:pe.totalPrice,priceCurrency:pe.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(pe.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:pe.membershipNumber,programName:pe.programName}),V.push(r)}for(var le,W=0;Q.length>W;W++)le=Q[W],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:le.totalPrice,priceCurrency:le.priceCurrency,reservationId:le.reservationId,reservationStatus:"http://schema.org/Reservation"+(le.reservationStatus||"Confirmed"),checkinUrl:le.checkinUrl,modifyReservationUrl:le.modifyReservationUrl,cancelReservationUrl:le.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:le.name,email:le.email},provider:{"@type":"http://schema.org/Organization",name:le.provider},pickupTime:le.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:le.pickupName,telephone:le.pickupTelephone,address:le.pickupAddress},dropoffTime:le.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:le.dropoffName,telephone:le.dropoffTelephone,address:le.dropoffAddress}},le.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:le.brand},license:le.license,color:le.color}),V.push(r);for(var A,W=0;K.length>W;W++)A=K[W],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:A.name,email:A.email},totalPrice:A.totalPrice,priceCurrency:A.priceCurrency,checkinTime:A.checkInDateTime,checkoutTime:A.checkOutDateTime,modifyReservationUrl:A.modifyReservationUrl,cancelReservationUrl:A.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(A.reservationStatus||"Confirmed"),reservationId:A.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:A.hotelName,url:A.hotelUrl,telephone:A.hotelPhone,address:A.hotelAddress}},V.push(r);if(V.length)return V}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1010/1168/1172","SGd546163e")]);
